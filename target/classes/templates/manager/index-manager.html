<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>保护伞人寿后台管理系统客户经理主页</title>
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"/>
    <link rel="stylesheet" href="/css/font.css">
    <link rel="stylesheet" href="/css/xadmin.css">
    <script type="text/javascript" src="/js/jquery-3.2.1.min.js"></script>
    <script src="/lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="/js/xadmin.js"></script>

</head>
<body>
<!-- 顶部开始 -->
<div class="container">
    <div class="logo"><a>保险销售客户经理系统</a></div>
    <div class="left_open">
        <i title="展开左侧栏" class="iconfont">&#xe699;</i>
    </div>
<!--    <ul class="layui-nav left fast-add" lay-filter="">-->
<!--        <li class="layui-nav-item">-->
<!--            <a href="javascript:;">+新增</a>-->
<!--            <dl class="layui-nav-child"> &lt;!&ndash; 二级菜单 &ndash;&gt;-->
<!--                <dd><a onclick="x_admin_show('资讯','http://www.baidu.com')"><i class="iconfont">&#xe6a2;</i>资讯</a></dd>-->
<!--                <dd><a onclick="x_admin_show('图片','http://www.baidu.com')"><i class="iconfont">&#xe6a8;</i>图片</a></dd>-->
<!--                <dd><a onclick="x_admin_show('用户','http://www.baidu.com')"><i class="iconfont">&#xe6b8;</i>用户</a></dd>-->
<!--            </dl>-->
<!--        </li>-->
<!--    </ul>-->
    <ul class="layui-nav right" lay-filter="">
        <li class="layui-nav-item">
            <a href="javascript:;">
                <img id="head" th:src="${session.manager.MPic}" width="50px" height="30px">
                <span style="color:#d0dfe8;" th:text="${session.manager.MLogin}"></span>
            </a>
            <dl class="layui-nav-child"> <!-- 二级菜单 -->
                <dd><a onclick="x_admin_show('更改头像','/indexM/managerInfo',500,600)">个人信息</a></dd>
                <dd><a onclick="x_admin_show('修改密码','/indexM//updatePwd',500,600)">修改密码</a></dd>
                <dd><a href="/login/loginPage">退出</a></dd>
            </dl>
        </li>
    </ul>

</div>
<!-- 顶部结束 -->
<!-- 中部开始 -->
<!-- 左侧菜单开始 -->
<div class="left-nav">
    <div id="side-nav">
        <ul id="nav">

            <li>
<!--                <a href="javascript:;">-->
                <a _href="/schedule/scheduleList">
                <i class="iconfont">&#xe6b8;</i>
                    <cite>日程管理</cite>
<!--                    <i class="iconfont nav_right">&#xe697;</i>-->
                </a>
<!--                <ul class="sub-menu">-->
<!--                    <li>-->
<!--                        <a _href="/schedule/scheduleList">-->
<!--                            <i class="iconfont">&#xe6a7;</i>-->
<!--                            <cite>日程列表</cite>-->
<!--                        </a>-->
<!--                    </li>-->
<!--                </ul>-->
            </li>

            <li>
<!--                <a href="javascript:;">-->
                <a _href="/serviceInfoManage/serviceList">
                <i class="iconfont">&#xe723;</i>
                    <cite>服务记录管理</cite>
<!--                    <i class="iconfont nav_right">&#xe697;</i>-->
                </a>
<!--                <ul class="sub-menu">-->
<!--                    <li>-->
<!--                        <a _href="/serviceInfoManage/serviceList">-->
<!--                            <i class="iconfont">&#xe6a7;</i>-->
<!--                            <cite>服务记录列表</cite>-->
<!--                        </a>-->
<!--                    </li>-->
<!--                </ul>-->
            </li>

            <li>
<!--                <a href="javascript:;">-->
                <a _href="/contact/list">
                <i class="iconfont">&#xe726;</i>
                    <cite>联系人管理</cite>
<!--                    <i class="iconfont nav_right">&#xe697;</i>-->
                </a>
<!--                <ul class="sub-menu">-->
<!--                    <li>-->
<!--                        <a _href="/contact/list">-->
<!--                            <i class="iconfont">&#xe6a7;</i>-->
<!--                            <cite>联系人列表</cite>-->
<!--                        </a>-->
<!--                    </li>-->
<!--                </ul>-->
            </li>

        </ul>
    </div>
</div>
<!-- <div class="x-slide_left"></div> -->
<!-- 左侧菜单结束 -->
<!-- 右侧主体开始 -->
<div class="page-content">
    <div class="layui-tab tab" lay-filter="xbs_tab" lay-allowclose="false">
        <ul class="layui-tab-title">
            <li>---</li>
        </ul>
        <div class="layui-tab-content">
            <div class="layui-tab-item layui-show">
                <iframe src='/contact/list/' frameborder="0" scrolling="yes" class="x-iframe"></iframe>
            </div>
        </div>
    </div>
</div>
<div class="page-content-bg"></div>
<!-- 右侧主体结束 -->
<!-- 中部结束 -->
<!-- 底部开始 -->
<div class="footer">
    <div class="copyright">Copyright ©2017 rock</div>
</div>
<!--提示框内容-->
<div id="datemessage" style="display: none">
    <div id="indate">
    </div>
    <div id="outdate">

    </div>
</div>
</body>
</html>
<script>

    //事件
    function load() {

        layui.use('layer', function () { //独立版的layer无需执行这一句
            var $ = layui.jquery,
                layer = layui.layer; //独立版的layer无需执行这一句

            //弹窗
            layer.open({
                title: '日程提醒',
                type: 1
                , offset: 'auto'
                , id: 'layerDemo' + 'auto' //防止重复弹出
                , content: $('#datemessage')
                , btn: '好的 我知道啦'
                , btnAlign: 'c' //按钮居中
                , shade: 0 //不显示遮罩
                , yes: function () {
                    layer.closeAll();
                }
            });

            $('#layerDemo .layui-btn').on('click', function () {
                var othis = $(this), method = othis.data('method');
                active[method] ? active[method].call(this, othis) : '';
            });

        });
    }

    var websocket = null;

    //判断当前浏览器是否支持WebSocket
    if ('WebSocket' in window) {
        websocket = new WebSocket("ws://localhost:8080/websocket");
    } else {
        alert('Not support websocket')
    }

    //连接发生错误的回调方法
    websocket.onerror = function () {
        setMessageInnerHTML("error");
    };

    //连接成功建立的回调方法
    websocket.onopen = function (event) {
        setMessageInnerHTML("open");
    }

    //连接关闭的回调方法
    websocket.onclose = function () {
        setMessageInnerHTML("close");
    }

    //接收到消息的回调方法
    websocket.onmessage = function (event) {

        console.log("接收到消息的回调数据" + event.data);
        var model = event.data;

        model = JSON.parse(model);//这里把字符串转为json.
        console.log(model);
        //创建两个个拼接字符串的变量
        var indatehtml = "";
        var outdatehtml = "";
        for (i = 0; i < model.OutDateText.length; i++) {
            outdatehtml += "<p>" + model.OutDateText[i] + "</p>"
        }
        for (j = 0; j < model.InDateText.length; j++) {
            indatehtml += "<p>" + model.InDateText[j] + "</p>"
        }

        //把indatehtml加载到div
        $("#indate").html(indatehtml);
        //把indatehtml加载到div
        $("#outdate").html(outdatehtml);
        load();
    }

    //监听窗口关闭事件，当窗口关闭时，主动去关闭websocket连接，防止连接还没断开就关闭窗口，server端会抛异常。
    window.onbeforeunload = function () {
        websocket.close();
    }

    //将消息显示在网页上
    function setMessageInnerHTML(innerHTML) {
        document.getElementById('message').innerHTML += innerHTML + '<br/>';
    }

    //关闭连接
    function closeWebSocket() {
        websocket.close();
    }

    //发送消息
    function send() {
        var message = document.getElementById('text').value;
        websocket.send(message);
    }
</script>